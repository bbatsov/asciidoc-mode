= asciidoc-mode
:url-repo: https://github.com/bbatsov/asciidoc-mode
:url-grammar: https://github.com/cathaysia/tree-sitter-asciidoc

A tree-sitter-based major mode for editing https://asciidoc.org[AsciiDoc] files in Emacs.

== Features

* Syntax highlighting via tree-sitter (headings, inline markup, blocks, lists, admonitions, macros, attributes)
* Section navigation (`C-M-a` / `C-M-e`) and sentence-level movement (`M-a` / `M-e`) across paragraphs and blocks
* Imenu support for section navigation
* Outline minor mode enabled by default -- heading navigation (`C-c C-n/p/f/b/u`) and folding
* Comment support (`//` line comments)
* Graceful degradation -- works as basic `text-mode` when grammars are unavailable

== Rationale

I've been maintaining https://github.com/bbatsov/adoc-mode[adoc-mode] since 2022, but over time I realized I rarely used many of its advanced features (e.g. inline image preview, interactive markup commands, tempo templates, native code block highlighting). I wanted something simpler.

`asciidoc-mode` is my attempt to build a leaner alternative to `adoc-mode`, not a replacement for it. The key differences:

- Tree-sitter for robust, accurate font-locking and optimal performance in large documents
- Simple by design -- focuses on the essentials (highlighting, navigation, folding) without the bells and whistles
- Single-file implementation with minimal complexity

I named it `asciidoc-mode` instead of `adoc-ts-mode` because it shares nothing with `adoc-mode` and I wanted to emphasize that. There has never been an `asciidoc-mode` before, so `asciidoc-ts-mode` felt too verbose for no good reason.

`adoc-mode` will continue to be maintained and evolved separately. Pick whichever suits your workflow.

[cols="1,^1,^1", options="header"]
|===
| Feature | asciidoc-mode | adoc-mode

| Syntax highlighting
| Tree-sitter
| Regex

| Imenu
| Yes
| Yes

| Outline / folding
| Yes
| Yes

| Section navigation
| Yes
| No

| Sentence navigation
| Yes
| No

| Markup insertion commands
| No
| Yes

| Tempo templates
| No
| Yes

| Inline image preview
| No
| Yes

| Title promotion / demotion
| No
| Yes

| Native code block highlighting
| No
| Yes

| Flyspell integration
| No
| Yes

| Compilation error support
| No
| Yes

| Emacs requirement
| 30.1+
| 26.1+
|===

== Requirements

* Emacs 30.1 or later (built with tree-sitter support)
* Two tree-sitter grammars from {url-grammar}[cathaysia/tree-sitter-asciidoc]:
** `asciidoc` (block-level structure)
** `asciidoc_inline` (inline formatting)

== Installation

=== Grammar Setup

After installing the package, run:

[source,emacs-lisp]
----
M-x asciidoc-install-grammars
----

This downloads and compiles both grammars automatically. You only need to do this once.

=== Package Installation

The package is not yet available on MELPA or NonGNU ELPA. For now, install directly from GitHub.

==== use-package with vc

Emacs 30+ has built-in support for installing packages from VCS:

[source,emacs-lisp]
----
(use-package asciidoc-mode
  :vc (:url "https://github.com/bbatsov/asciidoc-mode" :branch "main"))
----

==== Manual

Clone the repository and add it to your `load-path`:

[source,emacs-lisp]
----
(add-to-list 'load-path "/path/to/asciidoc-mode")
(require 'asciidoc-mode)
----

== Usage

Open any `.adoc` or `.asciidoc` file and `asciidoc-mode` activates automatically.

== Development

The project uses https://emacs-eldev.github.io/eldev/[Eldev] for build tooling and https://github.com/jorgenschaefer/emacs-buttercup[Buttercup] for testing.

[source,shell]
----
# Install Eldev (if not already installed)
curl -fsSL https://raw.github.com/emacs-eldev/eldev/master/webinstall/eldev | sh

# Run everything
make all

# Individual targets
make compile   # Byte-compile with warnings-as-errors
make lint      # Run elisp-lint
make test      # Run buttercup tests
make clean     # Remove build artifacts
----

NOTE: Font-lock tests require the tree-sitter grammars to be installed. Tests that need grammars will be skipped (not failed) if they are unavailable.

== License

Licensed under the GNU General Public License v3.0 or later. See link:LICENSE[LICENSE] for details.
